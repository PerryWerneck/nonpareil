TODO list for Nonpareil
Copyright 1995, 2003, 2004, 2005 Eric L. Smith <eric@brouhaha.com>
$Id$


Bugs and critical features for next release:

  Regression: keyboard not working at all.

  Voyager annunciators.


Build process:

  Create an RPM .spec file.  "scons dist" should create the nonpareil.spec
  file from a template, so that "rpmbuild -tb" will work with the release
  tarball.


User interface:

  Add ability to read kml, image, microcode from zip file.
      GSF: http://www.gnome.org/projects/libgsf/
          examples in CVS: http://cvs.gnome.org/viewcvs/libgsf/tests/
	  use a GdkPixbufLoader instead of gdk_pixbuf_new_from_file().
      On Windows, build ZIP into .EXE similar to a self-extractor?

  Display segments from image file rather than as line segments and
  rectangles.

  Transparency/shape: improve support for moving window: add KML
  syntax to specify keyboard rectangle, and use only region outside
  rectangle for dragging.

  Improve keyboard support:
      Release key when focus is lost.
      Ignore key release and hold key for a fixed (configurable?) number of
          simulation cycles?

  Implement edit menu commands:
      Edit - Copy, Paste

  Make button highlighting look better.

  Make slide switches look better.

  Add help.

  Create an icon.

  Calculator model selection at runtime.

  Create a fancier About box.  Use GtkAboutDialog, which allows for
  clickable website URLs and email addresses, license window, etc.

  Extract comments from image file and include in About box.  PNG
  comment keywords to use:
      Author
      Title
      Description
      Copyright
      Disclaimer
      Warning
      URL (unofficial)
  Unfortunately getting the comments will require the file to be
  read twice, once by gdk_pixbuf_new_from_file(), and once by direct
  calls to libpng, libjpeg, etc.  Update: maybe can do parallel
  parsing on the fly, by reading the file myself and passing the
  data into a GdkPixbufLoader.


Internals:

  Complete support for -41C .mod files

  Rework -41C microcode storage to use pointers to 4Kword pages:
      typedef rom_word_t rom_page_t [PAGE_SIZE];
      rom_page_t *roms [MAX_PAGE][MAX_BANK];
      rom_page_t *current_bank [MAX_PAGE];

  Use glib file handling:
    g_build_filename()
    g_stat()

  Use glib memory allocation/deallocation

  Split proc.c into separate GUI thread and simulator thread portions.

  Move more of the simulator initialization into the simulator thread.

  New memory API.

  Use glib 2.6 commandline option parser (g_option_xxx functions).

  Only send display update message to GUI thread if display has changed.

  Add code to remove async queue g_source when simulator thread exits.

  Use io_count to improve display update timing (already done in nut, add to
  classic and woodstock).

  Change op_arith for Classic and Woodstock to work like Nut, for a
  substantial reduction in cyclomatic complexity.

  Split ALU functions into separate source file.

  Replace globals in csim.c with structure.  Allow for multiple instances.


KML:

  It would be nice to use a pure parser for KML, pass in the kml_t
  pointer as input, and return it from read_kml_file().  But Flex
  doesn't yet seem to have support for the Bison pure_parser option.
  There exist patches, but I don't want to make people use those.
  Better to wait for a production release of Flex.

  Use XML files instead of KML?  (.nml?)


Assembler:

  Clean up memory usage of symbols in CASM

  Implement symbol cross-reference in CASM


Disassembler:

  Add disassembler for Classic processors.

  Make disassembler talk to sim thread rather than passing in two
  words as parameters.


Debugger:

  Make the register window update, and make changes get written to
  register.  Disable editing (and grey out?) while running.

  Add debugger commands.  Pass dbt_t as arg to commands.

  Create new VTE patch based on feedback from Nalin.

  Change Tcl standard I/O streams to use pty file descriptor.

  Implement async queue based functions needed by debugger.


Better model support:

  Add Phineas (timer chip in Time Module/41CX).

  Scan images at uniform scale and without JPEG compression.

  Dump actual ROMs:
      Classic:    HP-45, HP-55, HP-65, HP-70, HP-80
      Classic/printing:  HP-46, HP-81, HP 9805A
      Woodstock:  HP-22, HP-27, HP-29C
      Topcat:     HP-91, HP-92, HP-95C, HP-97
      Sting:      HP-10, HP-19C
      Spice:      HP-31E, HP-33E
      Cricket:    HP-01

  Compare actual HP-45, HP-55, and HP-80 ROMs to CASM output.

  Add Woodstock microinstructions for card reader (HP-67, HP-97)

  Add Woodstock microinstructions for printer (HP-19C, HP-91, HP-92, HP-95C, HP-97)

  Add HP-65 microinstructions for program memory access.

